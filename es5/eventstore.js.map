{"version":3,"sources":["webpack:///webpack/bootstrap c30ab460bb7ae615295c","webpack:///./js/eventstore.js"],"names":["es","streamUrl","command","todo","eventType","callback","console","log","todolist","$","ajax","type","url","data","JSON","stringify","contentType","headers","done","addTodo","showListItems","toggleDone","deleteTodo","getTodolist","eventNumber","events","getEntriesPromise","then","max","Math","apply","e","map","o","text","filtered","filter","aggregate","util","sortObjects","forEach","parse","push","id","Number","entries","Promise","resolve","reject","Accept","d","previous","links","v","relation","uri","concat"],"mappings":"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","file":"eventstore.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap c30ab460bb7ae615295c","es = {};\r\n\r\n( () => {\r\n  const streamUrl = 'http://127.0.0.1:2113/streams/todolist'\r\n\r\n  /********** COMMANDS **********/\r\n  // common function\r\n  let command = ( todo, eventType, callback ) => {\r\n    console.log( eventType, todolist );\r\n    $.ajax( {\r\n      type: 'POST',\r\n      url: streamUrl,\r\n      data: JSON.stringify( todo ),\r\n      contentType: 'application/json',\r\n      headers: {\r\n        'ES-EventType': eventType\r\n      }\r\n    } ).done( d => {\r\n      if ( callback ) {\r\n        callback();\r\n      }\r\n    } );\r\n  }\r\n\r\n  // Add To Do\r\n  es.addTodo = ( todo, showListItems ) => {\r\n    command( todo, 'addTodo', showListItems );\r\n  }\r\n\r\n  // Toggle Done\r\n  es.toggleDone = ( todo ) => {\r\n    command( todo, 'toggleDone' );\r\n  }\r\n\r\n  // Delete To Do\r\n  es.deleteTodo = ( todo ) => {\r\n    command( todo, 'deleteTodo' );\r\n  }\r\n\r\n  /********** QUERY **********/\r\n  // Get To Do List\r\n  es.getTodolist = ( showListItems, eventNumber ) => {\r\n      let events = [];\r\n      getEntriesPromise( streamUrl + '/0/forward/100?embed=body', [] ).then( e => {\r\n        let max = Math.max.apply( null, e.map( o => {\r\n          return o.eventNumber;\r\n        } ) );\r\n        $( '#maxEventNumber' ).text( max );\r\n\r\n        let filtered = e;\r\n        if ( eventNumber ) {\r\n          filtered = e.filter( data => {\r\n            return data.eventNumber <= eventNumber;\r\n          } );\r\n        }\r\n        todolist = aggregate( filtered );\r\n        showListItems();\r\n      } );\r\n    }\r\n    /********** Aggregate **********/\r\n    // aggregate todo list from events\r\n  let aggregate = events => {\r\n    console.log( 'AGGREGATE', events );\r\n    let todolist = [];\r\n    events = util.sortObjects( events, 'updated', true );\r\n    events.forEach( e => {\r\n      let data = JSON.parse( e.data );\r\n      if ( e.eventType === 'addTodo' ) {\r\n        todolist.push( data );\r\n      } else if ( e.eventType === 'toggleDone' ) {\r\n        todolist.map( todo => {\r\n          if ( todo.id === Number( data.id ) ) {\r\n            todo.done = data.done;\r\n          }\r\n          return todo;\r\n        } );\r\n      } else if ( e.eventType === 'deleteTodo' ) {\r\n        todolist = todolist.filter( todo => todo.id !== Number( data.id ) );\r\n      }\r\n    } );\r\n    return todolist;\r\n  }\r\n\r\n  /********** HELPERS **********/\r\n  // Get Entries Promise\r\n  let getEntriesPromise = ( url, entries ) => {\r\n    return new Promise( ( resolve, reject ) => {\r\n      $.ajax( {\r\n        type: 'GET',\r\n        url,\r\n        headers: {\r\n          Accept: 'application/vnd.eventstore.atom+json',\r\n        },\r\n      } ).done( ( d ) => {\r\n        let previous = d.links.filter( v => v.relation === 'previous' )[ 0 ];\r\n        if ( previous ) {\r\n          getEntriesPromise( previous.uri + '?embed=body', entries.concat( d.entries ) ).then( d => {\r\n            resolve( d );\r\n          } );\r\n        } else {\r\n          resolve( entries.concat( d.entries ) );\r\n        }\r\n      } );\r\n    } );\r\n  }\r\n\r\n} )();\r\n\n\n\n// WEBPACK FOOTER //\n// ./js/eventstore.js"],"sourceRoot":""}